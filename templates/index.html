<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AI by Design.chat</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
    <!-- Add offline fallback for Font Awesome -->
    <style>
        /* Fallback icons if Font Awesome fails to load */
        .fa-arrow-up:before {
            content: "â†‘";
        }
    </style>
    <!-- Error handling and connection status -->
    <script>
        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error caught:', event.error);
            // Update UI to show error if it's critical
            const errorBanner = document.getElementById('error-banner');
            if (errorBanner) {
                errorBanner.textContent = 'An error occurred. Please refresh the page.';
                errorBanner.style.display = 'block';
            }
            return false;
        });
        
        // Check internet connection
        function updateOnlineStatus() {
            const statusIndicator = document.getElementById('connection-status');
            if (!statusIndicator) return;
            
            if (navigator.onLine) {
                statusIndicator.textContent = '';
                statusIndicator.style.display = 'none';
            } else {
                statusIndicator.textContent = 'Offline - Messages will be sent when reconnected';
                statusIndicator.style.display = 'block';
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
    </script>
</head>
<body>
    <div class="chat-container">
        <!-- Error banner for critical errors -->
        <div id="error-banner" class="error-banner" style="display: none;"></div>
        
        <!-- Connection status indicator -->
        <div id="connection-status" class="connection-status" style="display: none;"></div>
        
        <div class="chat-header">
            <div class="logo-container">
                <img src="/static/images/White logo - no background.png" alt="AI BY DESIGN" class="logo" 
                     onerror="this.onerror=null; this.src='/static/images/fallback-logo.png'; this.alt='AI BY DESIGN';">
            </div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div class="message assistant">
                <div class="message-content">
                    <p>Hi there! ðŸ‘‹ I'm your AI by Design Copilot. I can answer questions by searching Wikipedia and the Web. I can also write and execute code securely. How can I help you today?</p>
                </div>
            </div>
            <!-- Messages will be added here dynamically -->
            <noscript>
                <div class="message system">
                    <div class="message-content">
                        <p>JavaScript is required for this application to function. Please enable JavaScript in your browser settings.</p>
                    </div>
                </div>
            </noscript>
        </div>
        
        <div class="chat-input-container">
            <textarea id="chat-input" placeholder="Type a message..." rows="1" aria-label="Type your message"></textarea>
            <button id="send-btn" aria-label="Send message"><i class="fas fa-arrow-up"></i></button>
        </div>
        
        <div class="chat-footer">
            <p>Powered by Gemini, GPT-4.1 & LangGraph</p>
        </div>
    </div>
    
    <!-- Fallback loading message if script takes too long to load -->
    <div id="loading-indicator" class="loading-indicator">
        Loading application...
    </div>
    
    <script>
        // Hide loading indicator on successful load
        window.addEventListener('load', function() {
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            updateOnlineStatus();
        });
        
        // Fallback if main script fails to load
        setTimeout(function() {
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator && loadingIndicator.style.display !== 'none') {
                loadingIndicator.textContent = 'App is taking longer than expected to load. Please refresh the page.';
            }
        }, 10000); // 10 seconds
    </script>
    
    <!-- Main application script with error handling -->
    <script src="/static/js/app.js" onerror="document.getElementById('error-banner').textContent = 'Failed to load application. Please refresh the page.'; document.getElementById('error-banner').style.display = 'block';"></script>
</body>
</html>